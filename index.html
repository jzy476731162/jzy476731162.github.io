<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="嘿嘿嘿">
<meta property="og:type" content="website">
<meta property="og:title" content="CJ的小窝">
<meta property="og:url" content="http://jzy476731162.github.io/index.html">
<meta property="og:site_name" content="CJ的小窝">
<meta property="og:description" content="嘿嘿嘿">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CJ的小窝">
<meta name="twitter:description" content="嘿嘿嘿">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> CJ的小窝 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">CJ的小窝</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/02/iOS绘图思想/" itemprop="url">
                  iOS绘图思想
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-02T16:31:02+08:00" content="2016-06-02">
              2016-06-02
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/02/iOS绘图思想/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/02/iOS绘图思想/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/06/02/iOS绘图思想/" class="leancloud_visitors" data-flag-title="iOS绘图思想">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://developer.apple.com/library/ios/documentation/2DDrawing/Conceptual/DrawingPrintingiOS/GraphicsDrawingOverview/GraphicsDrawingOverview.html" target="_blank" rel="external">原文链接</a><br><!--[TOC]--></p>
<hr>
<h2 id="iOS绘图思想"><a href="#iOS绘图思想" class="headerlink" title="iOS绘图思想"></a>iOS绘图思想</h2><p>高质量图像是应用UI中重要的一部分，提供高质量图像不仅会让应用看起来更棒，还会使它看起来像原生系统的扩展。iOS系统提供两种基础的方式来创建高质量图像：<code>openGL</code>或<code>原生渲染(Quartz，Core Animation，UIkit)</code>。本文描述的是用原生渲染(如果您想学习OpenGL绘图，<a href="https://developer.apple.com/library/ios/documentation/3DDrawing/Conceptual/OpenGLES_ProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40008793" target="_blank" rel="external">请看链接</a>)</p>
<p>Quartz是主要的绘画接口，提供支持如：基于路径的绘图，抗锯齿渲染，渐变填充图案，图片，颜色，坐标空间变换，以及PDF创建、显示、解析。UIKit提供了通过OC封装的文字艺术(line art)，Quartz 图片以及颜色处理。Core Animation为UIKit中view的property的基础动画变换提供了底层支持并且可以用来实现自定义动画。</p>
<p>本章节提供了iOS应用绘画的过程概述，伴随着每一种绘画技术都会有特定的绘画技巧。你将找到在iOS平台上优化绘画代码的提示和指导。</p>
<blockquote>
<p>不是所有的UIkit类都是线程安全的。在主线程外的其他线程中执行绘画操作时请先检查文档。</p>
</blockquote>
<hr>
<h3 id="UIKit-图像系统"><a href="#UIKit-图像系统" class="headerlink" title="UIKit 图像系统"></a>UIKit 图像系统</h3><p>在iOS中，所有在屏幕上绘画出来的-不管是通过OpenGL，Quartz，UIKit还是Core Animation - 都是在UIView的一个实例或子类范围中操作。Views决定了在屏幕上绘制发生的部位。如果你使用系统提供的views，系统会为你自动绘制。如果你定义的是自定义views，你必须自己提供绘制的代码。如果使用Quartz，Core Animation，UIkit去绘制，你将会用到在接下来的章节中描述的绘图思想。</p>
<p>除了立刻在屏幕上绘制，UIKit也允许你画到离屏的位图或者PDF图形的上下文中。当你在离屏上下文中绘制时，不是在一个view中绘制，也意味着在view的绘图周期中是不推荐这么做的(除非你随后取出图像并且在imageView或相似空间中绘制出来)。</p>
<h4 id="View绘图循环"><a href="#View绘图循环" class="headerlink" title="View绘图循环"></a>View绘图循环</h4><p>子类化的UIView的基础绘画模式是在必要时更新内容。UIView类使得更新过程更加简单有效：通过收集你发出的更新请求并将它们在合适的时机传输到你的绘制代码中。</p>
<p>当一个view第一次被展示出来或者view的一部分需要被重新绘制，iOS通过调用view的<strong><code>drawRect:</code></strong>方法让view绘制它的内容。还有很多行为可以触发view的更新：</p>
<blockquote>
<ul>
<li>移动或移除一个正在遮挡view的另一个view</li>
<li>通过设置一个view的<code>hidden</code>为No来使得先前隐藏的view可见</li>
<li>将一个view从屏幕中划出后划入屏幕</li>
<li>立刻调用view的方法：<code>setNeedsDisplay</code>或<code>setNeedsDisplayInRect:</code></li>
</ul>
</blockquote>
<p>系统views是自动重绘的。对于自定义views来说，必须重载<code>drawRect:</code>方法并在其中执行绘制代码。在<code>drawRect：</code>方法中，使用原生绘制技术来绘画图形，文本，图像，渐变或其他你想要的视觉内容。你的view第一次变得可见时，iOS将一个矩形传入view的<code>drawRect:</code>方法，这个矩形包含了view的整个可见区域。在随后的调用中，这个矩形只包括需要重绘的区域。为了使性能最大化，你应该仅重绘受影响的区域。</p>
<p>在调用<code>drawRect:</code>之后，view将自己标记成<code>已更新(updated)</code>并且等待新操作来临以及触发另外一个更新循环。如果view展示的是静态内容，在由滑动和其它views的存在导致你的view的能见变化时，你唯一需要做的就是响应这些变化。</p>
<p>如果你想改变view的内容，必须通知view去重绘内容。调用<code>setNeedsDisplay</code>或<code>setNeedsDisplayInrect:</code>来触发一个更新。举个栗子，如果一秒内需要多次更新内容，你可能会想创建一个定时器来刷新view。也可以在响应用户操作或在view中创建新内容来更新view。</p>
<blockquote>
<p>不要手动调用<code>drawRect：</code>，该方法<strong><em>仅</em></strong>应在iOS屏幕重绘期间通过代码创建。在其他情况下，图形上下文不存在，所以也不可能绘制（图像上下文会在下一章节中解释）</p>
</blockquote>
<p>####iOS中的坐标系统以及绘制<br>当一个应用在iOS中绘制时，它必须在定义为坐标系统的二维空间内定位出绘制的内容位置。这个概念在第一眼看到时会觉得很直观，但事实上却很麻烦。iOS应用在绘制时有时需要应对不同的坐标系。</p>
<p>在iOS中，所有的绘制都在图形上下文中完成。从概念上讲，图形上下文是一个描述<code>哪里</code>、以及<code>怎么</code>绘制的对象，包含基础的绘制属性，例如绘制中使用的颜色，裁剪区域，线条宽度和样式信息，字体信息，合成选项等等。</p>
<p>此外，如图1-1中所示，每一个图形上下文都有一个坐标系。更确切的说，每一个图形上下文有三个坐标系：</p>
<blockquote>
<ul>
<li><code>绘图坐标系(用户)</code>。该坐标系是用于绘图任务的执行。</li>
<li><code>view坐标系(基础空间)</code>。该坐标系是与view相关的固定的坐标系。</li>
<li><code>设备坐标系(物理)</code>。该坐标系代表屋里屏幕上的像素。</li>
</ul>
</blockquote>
<p><img src="https://developer.apple.com/library/ios/documentation/2DDrawing/Conceptual/DrawingPrintingiOS/Art/coordinate_differences_2x.png" alt="图1-1 绘图坐标，view坐标，硬件坐标的关系"></p>
<p>iOS绘图框架可以创建一系列绘制的具体目标的上下文 - 屏幕，位图，PDF内容等等 - 并且这些图形上下文为该目标建立了具体的初始坐标系统。这个初始坐标系统被称作<code>默认坐标系</code>，它是1：1映射到view底层坐标系统的。</p>
<p>每一个view拥有一个<code>当前变换矩阵(current transformation matrix(CTM))</code>，是一个数学矩阵，将当前绘制坐标系中的点映射到(固定的)<code>view坐标系</code>中。应用可以更改这个矩阵来改变接下来绘制操作的表现。</p>
<p>每一个iOS绘制框架都会在当前图形上下文中建立一个<code>默认坐标系</code>。在iOS中，有两种主要的坐标系统：</p>
<blockquote>
<ul>
<li>左上原点坐标系(upper-left-origin(ULO))，绘制操作的原点在绘制区域的左上角，向下和向右都是正值。用于UIKit和Core Animation的<code>默认坐标系</code>是基于ULO的。</li>
<li>左下原点坐标系(lower-left-origin(LLO))，绘制操作的原点在绘制区域的左下角，向上和向右都是正值。用于Core Graphics框架的<code>默认坐标系</code>是基于LLO的。</li>
</ul>
</blockquote>
<p><img src="https://developer.apple.com/library/ios/documentation/2DDrawing/Conceptual/DrawingPrintingiOS/Art/flipped_coordinates-2_2x.png" alt="iOS中的默认坐标系"></p>
<blockquote>
<p>OS X中的<code>默认坐标系</code>是基于LLO的。尽管Core Graphics以及AppKit框架的绘制方式和方法都完美适用于该坐标系，AppKit为左上角坐标系提供翻转坐标系的程序支持。</p>
</blockquote>
<p>在调用<code>drawRect：</code>之前，UIkit为绘图操作建立了<code>默认坐标系</code>，(本句原文:UIKit establishes the default coordinate system for drawing to the screen by making a graphics context available for drawing operations)。在<code>drawRect：</code>中，应用可以设置图形状态参数(例如填充的颜色)以及在不需要明确指出图形上下文的前提下在当前的图形上下文中绘制。这种隐式的图形上下文建立了一个<code>ULO默认坐标系</code></p>
<h4 id="点与像素"><a href="#点与像素" class="headerlink" title="点与像素"></a>点与像素</h4><p>在iOS中 在绘图代码中你指定的坐标系和实际底层设备的像素点是不同的。当使用原生绘图技术例如Quartz，UIKit，Core Animation，绘制坐标空间和view的坐标空间都是逻辑坐标空间。以points作为衡量单位。这些逻辑坐标系是在设备坐标空间使用系统框架在屏幕上管理pixels来解耦出来的。</p>
<p>系统自动的将view坐标空间的point映射为设备坐标空间的pixels，但不总是一对一的映射。这种特性引出了一个你需要记住的重要事实：</p>
<blockquote>
<p><strong>point不一定与pixel相同</strong></p>
</blockquote>
<p>使用points的目的是在无关设备间提供一个相同尺寸的输出。在大多数情况下，point的实际尺寸是不相干的。使用point的目的是提供一个相对一致的尺寸，你可以在代码中指定view的尺寸和位置并且渲染内容。point与pixel的映射方式实际是由系统框架处理的。举个栗子，在高分辨率屏幕的设备上，一个一point宽的线实际是两个pixel那么宽。结果就是如果你在两个相似的设备上绘制相同的内容，其中一个是高质量屏幕，在这两个设备上看到的内容看起来尺寸相同。</p>
<blockquote>
<p>在PDF渲染和打印的上下文中，Core Graphics定义了<code>point</code> 是使用工业标准映射一英尺的1/72。</p>
</blockquote>
<p>在iOS中，UIScreen，UIVew，UIImage，CALayer提供property来获取(或设置)缩放因子(scale factor)，缩放因子是描述point和pixel之间关系的一个特定对象。例如，每一个UIkit view有<code>contentScaleFactor</code>属性变量。在标准分辨率屏幕上，缩放因子一般为1.0.而在高分辨率屏幕上，缩放因子一般为2.0。在将来可能会出现其它缩放因子。(在iOS4以上，缩放因子应该被认作1.0)。</p>
<p>原生绘图技术，例如Core Graphics，考虑一下当前的缩放因子。例如，如果一个view实现了<code>drawRect:</code>方法，UIKit自动将view的缩放因子设置为屏幕的缩放因子。另外 UIKit通过考虑缩放因子画图可以自动修复图形上下文的<code>当前变换矩阵</code>。在<code>drawRect:</code>中绘制的内容会根据底层设备屏幕来适当的缩放。</p>
<p>由于自动映射，当写绘制的代码时，通常不必关注pixel。然而有些时候你需要根据point与pixel映射规则来改变应用的绘制行为-在高分辨率屏幕下载高质量图片或在低分辨率屏幕上绘制时避免异常的缩放。</p>
<p>在iOS中，当你在屏幕上绘制事物时，图像子系统使用一种抗锯齿技术将高质量图片显示在低分辨率屏幕上。最好的解释就是举例。当你在纯白色背景下绘制一条黑色竖线，如果线条正好落在1px上，你会看到在白色区域出现一系列黑色像素点。如果它在两个px之间展示，看起来就是两个紧邻的灰色像素，如下图所示。</p>
<p><center>(右边的称为whole-numbered point)</center><br><img src="https://developer.apple.com/library/ios/documentation/2DDrawing/Conceptual/DrawingPrintingiOS/Art/pixel_alignment_2x.png" alt=""></p>
<p>位置是由whole-numbered points在pixels中点决定的。距离，如果你从(1.0,1.0)到(1.0,10.0)画了一条1px宽的竖线，会得到一条模糊的灰线。如果你绘制了一条2px宽的线，会得到一条纯黑线，因为它完全的覆盖了2个px。一般来说，以px为单位，奇数为值 的宽度的线条看起来比偶数值px的线条更柔和，除非你调整他们的位置使线条与pixel格子重合。</p>
<p>比例因子的作用就是决定1point宽的线条覆盖了几个pixel。</p>
<p>在低分辨率的情况下(1.0缩放因子)，宽度 ： 1 point 线条= 1 pixel 线条。在画1point宽的线条时为了避免抗锯齿，除非是偶数pixels宽，否则你必须将位置向任一边偏移0.5point。如果线条是偶数points宽，为了避免模糊的线条一定不要这么做。</p>
<p><img src="https://developer.apple.com/library/ios/documentation/2DDrawing/Conceptual/DrawingPrintingiOS/Art/regular_vs_retina_2x.png" alt=""></p>
<p>在高分辨率情况下(缩放因子2.0)，1point宽的线条是不会产生抗锯齿情况，因为它占满了两个px格子(-0.5~+0.5)。如果想绘制1pixel的线条，将宽度设置为0.5points 并且偏移量设为0.25，对照如上图所示。</p>
<p>当然，改变基于缩放因子的绘图特性可能会导致悲剧。1px宽的线条在某些设备上看起来完美但是在高分辨率设备上可能会太细导致无法看清。决定权在你手上！</p>
<hr>
<h3 id="获取图像上下文"><a href="#获取图像上下文" class="headerlink" title="获取图像上下文"></a>获取图像上下文</h3><p>大多情况下，图形上下文已经为你配置好。每一个view对象会在<code>drawRect:</code>被调用时自动创建图形上下文来使你的代码立即绘制自定义的内容。作为配置的一部分，UIView的底层为当前绘制环境创建图形上下文(一个<code>CGContextRef</code>不透明的类型)<br>如果你想在view外绘制东西(例如在位图或PDF中捕获一系列绘制操作),如果调用Core Graphics方法是需要一个上下文对象的，你必须进行额外的步骤来获取上下文对象。以下部分解释了原因。</p>
<p>更多关于图形上下文，修改<code>图像状态(graphics state)</code>信息以及使用图形上下文来创建自定义内容，查看<a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/Introduction/Introduction.html#//apple_ref/doc/uid/TP30001066" target="_blank" rel="external">Quartz 2D Programming Guide</a>。关于图形上下文的一系列函数请参考这里<a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CGContext/index.html#//apple_ref/doc/uid/TP30000950" target="_blank" rel="external">CGContext Reference</a>,<a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CGBitmapContext/index.html#//apple_ref/doc/uid/TP30000947" target="_blank" rel="external">CGBitmapContext Reference</a>,<a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CGPDFContext/index.html#//apple_ref/doc/uid/TP30000957" target="_blank" rel="external">CGPDFContext Reference</a>.</p>
<h4 id="向屏幕上绘制"><a href="#向屏幕上绘制" class="headerlink" title="向屏幕上绘制"></a>向屏幕上绘制</h4><p>如果使用Core Graphics函数绘制view，无论在<code>drawRect:</code>方法或者别的地方，前提是需要一个图形上下文(大多数这些方法的第一个参数一定是<code>CGContectRef</code>对象)。你可以调用<a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIKitFunctionReference/index.html#//apple_ref/c/func/UIGraphicsGetCurrentContext" target="_blank" rel="external"><code>UIGraphicsGetCurrentContext</code></a>取得与在<code>drawRect:</code>中隐式创建的同一个上下文。由于是同一个图形上下文，绘制函数应该参考<code>ULO默认坐标系</code></p>
<p>如果想使用Core Graphics函数在UIKit的view中绘制，应该使用<code>ULO默认坐标系</code>来进行绘图操作。此外，你可以将<code>当前变换矩阵</code>翻转并且在UIKit的view中使用CoreGraphics原生的<code>LLO坐标系</code>进行绘制。<a href="https://developer.apple.com/library/ios/documentation/2DDrawing/Conceptual/DrawingPrintingiOS/GraphicsDrawingOverview/GraphicsDrawingOverview.html#//apple_ref/doc/uid/TP40010156-CH14-SW26" target="_blank" rel="external">Flipping the Default Coordinate System</a>中讨论了翻转的详情。</p>
<p><code>UIGraphicsGetCurrentContext</code>方法总是会返回一个当前有效的图形上下文。比如，如果你创建了一个PDF上下文并且调用了<code>UIGraphicsGetCurrentContext</code>，可以接收到一个PDF上下文。如果想使用CoreGraphics方法来在view上绘制就必须使用<code>UIGraphicsGetCurrentContext</code>返回的图形上下文。</p>
<blockquote>
<p><code>UIPrintPageRenderer</code>类声明了绘制可印刷内容的方法。在一个类似于<code>drawRect:</code>方法中，UIKit在这些方法的实现中设置了隐式的图形上下文。这个图形上下文建立了一个<code>ULO默认坐标系</code></p>
</blockquote>
<h4 id="绘制位图上下文和PDF上下文"><a href="#绘制位图上下文和PDF上下文" class="headerlink" title="绘制位图上下文和PDF上下文"></a>绘制位图上下文和PDF上下文</h4><p>UIKit提供了以下行为的方法：在位图图形上下文渲染图片，通过在PDF图形上下文中绘制产生PDF内容。调用这些方法的第一步都是创建一个图形上下文-分别是一个位图上下文或者PDF上下文。返回的对象作为当前(以及隐式)图形上下文进行连续的绘制和状态设置。当完成在上下文中的绘制，调用另外一个方法来关闭上下文。</p>
<p>UIKit的位图上下文和PDF上下文都建立了一个<code>ULO默认坐标系</code>。CoreGraphics也有对应的方法来在位图上下文中渲染和在PDF图形上下文中绘制。通过CoreGraphics创建的上下文是基于<code>LLO默认坐标系的</code>。</p>
<blockquote>
<p>在iOS中，建议你使用UIKit框架来绘制位图上下文和PDF上下文。如果你使用CoreGraphics作为备胎并打算显示渲染结果，你需要通过调整你的代码来弥补两个不同的默认坐标系的差异。更多信息请查看<a href="https://developer.apple.com/library/ios/documentation/2DDrawing/Conceptual/DrawingPrintingiOS/GraphicsDrawingOverview/GraphicsDrawingOverview.html#//apple_ref/doc/uid/TP40010156-CH14-SW26" target="_blank" rel="external">Flipping the Default Coordinate System</a></p>
</blockquote>
<hr>
<h3 id="颜色和色彩空间"><a href="#颜色和色彩空间" class="headerlink" title="颜色和色彩空间"></a>颜色和色彩空间</h3><p>iOS在Quartz中支持全系列色彩空间，然而大多数应用只需要RGB色彩空间，因为iOS被设计用于运行在嵌入式硬件并且在屏幕上显示图像，RGB色彩空间是最合适的选择。</p>
<p>UIColor对象提供了便捷的方法指定RGB，HSB，灰阶色值。如果以该方式创建颜色，不需要指定色彩空间，因为UIColor自动为你定义了一个。</p>
<p>也可以使用CoreGraphics框架中的<a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CGContext/index.html#//apple_ref/c/func/CGContextSetRGBStrokeColor" target="_blank" rel="external"><code>CGContextSetRGBStrokeColor</code></a>和<a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CGContext/index.html#//apple_ref/c/func/CGContextSetRGBFillColor" target="_blank" rel="external"><code>CGContextSetRGBFillColor</code></a>来创建和设置颜色。尽管CoreGraphics包含了对(通过创建其它色彩空间以及自定义色彩空间来创建颜色)的支持，我们还是不推荐这么做。绘制的代码应该一直使用RGB颜色。</p>
<h2 id="使用Quartz和UIKit绘制"><a href="#使用Quartz和UIKit绘制" class="headerlink" title="使用Quartz和UIKit绘制"></a>使用Quartz和UIKit绘制</h2><p>Quartz在iOS中是原生绘画技术的通用名。CoreGraphics框架是Quartz的核心，也是绘制内容最基础的接口。该框架提供了数据类型和函数可以操作以下内容:</p>
<blockquote>
<ul>
<li>图形上下文</li>
<li>路径</li>
<li>图片和位图</li>
<li>透明层</li>
<li>颜色，图案颜色和色彩空间</li>
<li>渐变和阴影</li>
<li>字体</li>
<li>PDF内容</li>
</ul>
</blockquote>
<p>Quartz是专注于设计图像相关操作的类而UIKit正是基于Quartz的基础特性设计的。UIKit 图像类并不是作为全能的绘图工具而设计的-CoreGraphics已经做到了。相反的，CG为其它的UIKit类提供绘图支持。UIKit支持以下类和方法:<br>|class | description|<br>|:—|—:|<br>|UIImage|显示图片|<br>|UIColor|为设备颜色提供基础支持|<br>|UIFont|为需要的类提供字体信息|<br>|UIScreen|提供屏幕相关基础信息|<br>|UIBezierPath|允许应用绘制线条、弧线、椭圆和其它|</p>
<blockquote>
<ul>
<li>产生JPEG或PNG格式的UIImage对象的方法</li>
<li>绘制位图图形上下文的方法</li>
<li>向PDF图形上下文内绘制来得到PDF数据的方法</li>
<li>绘制矩形，裁剪绘制区域的方法</li>
<li>改变和获得当前图形上下文的方法</li>
</ul>
</blockquote>
<p>更多UIKit的方法和类，查看<a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIKit_Framework/index.html#//apple_ref/doc/uid/TP40006955" target="_blank" rel="external">UIKit Framework Reference</a>。更多关于CoreGraphics框架的类型和函数，查看<a href="https://developer.apple.com/library/ios/documentation/CoreGraphics/Reference/CoreGraphics_Framework/index.html#//apple_ref/doc/uid/TP40007127" target="_blank" rel="external">Core Graphics Framework Reference</a></p>
<h4 id="配置图形上下文"><a href="#配置图形上下文" class="headerlink" title="配置图形上下文"></a>配置图形上下文</h4><p>在调用<code>drawRect:</code>之前，view对象创建了一个图形上下文并设置为默认。该上下文只存在于<code>drawRect:</code>被调用的生命周期中。可以调用<code>UIGraphicsGetCurrentContext</code>来获得该图形上下文的指针。返回值是CGContextRef类型，将它传入CoreGraphics函数中修改当前图形状态。下表列举出不同方面的<code>图像状态</code>。完整函数请看<a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CGContext/index.html#//apple_ref/doc/uid/TP30000950" target="_blank" rel="external">CGContext Reference</a></p>
<p><img src="http://ww1.sinaimg.cn/large/dae4fea2jw1f4ftkjixg0j214b0mkdp6.jpg" alt=""></p>
<p>图形上下文拥有一个存放<code>图像状态</code>的栈。当Quartz创建了一个图形上下文，此时栈是空的。使用<a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CGContext/index.html#//apple_ref/c/func/CGContextSaveGState" target="_blank" rel="external"><code>CGContextSaveGState</code></a>将当前图形上下文状态压栈。随后，你可以通过更改<code>图像状态</code>来影响接下来的绘制操作，但不会影响栈中存储的操作。当你完成修改后，你可以调用<a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CGContext/index.html#//apple_ref/c/func/CGContextRestoreGState" target="_blank" rel="external"><code>CGContextRestoreGState</code></a>弹出栈内上下文来返回之前的上下文状态。这样弹栈和压栈是一种返回之前状态的快速方法并且无需解开每个状态变化。(Pushing and popping graphics states in this manner is a fast way to return to a previous state and eliminates the need to undo each state change individually)。但这也是唯一用来存储一些状态的方式，例如裁剪路径，返回初始设置。<br>更多关于图形上下文的信息和使用它们的配置环境，查看<a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/dq_context/dq_context.html#//apple_ref/doc/uid/TP30001066-CH203" target="_blank" rel="external"><code>Graphics Contexts</code></a>,<a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/Introduction/Introduction.html#//apple_ref/doc/uid/TP30001066" target="_blank" rel="external"><code>Quartz 2D Programming Guide</code></a></p>
<h4 id="创建并绘制路径"><a href="#创建并绘制路径" class="headerlink" title="创建并绘制路径"></a>创建并绘制路径</h4><p>路径是从一系列线条和贝塞尔曲线的基于向量的图形。UIKit拥有<code>UIRectFrame</code>和<code>UIRectFill</code>方法来绘制简单的路径，例如你view中的矩形。CoreGraphics 也提供了创造简单路径譬如矩形和椭圆的便捷函数。</p>
<p>对于复杂的路径，需要使用<a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIBezierPath_class/index.html#//apple_ref/occ/cl/UIBezierPath" target="_blank" rel="external"><code>UIBezierPath</code></a>来自己创建路径，或使用CoreGraphics框架中操作<a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CGPath/index.html#//apple_ref/c/tdef/CGPathRef" target="_blank" rel="external"><code>CGPathRef</code></a>的函数。尽管可以不用图形上下文来创建路径，路径中的点必须参考默认坐标系(ULO或LLO)，你仍旧需要使用图形上下文来渲染路径。</p>
<p>当绘制路径时，必须有当前上下文集。该图集可以是自定义view的(drawRect:中)上下文，位图上下文或者PDF上下文。坐标系决定了路径的渲染方式。<code>UIBezierPath</code>默认使用<code>ULO坐标系</code>，也就是说如果你的view被翻转使用了LLO坐标系，图形渲染结果可能会与预期不同。最好是指定点与用于渲染的图形上下文的当前坐标系原点绑定。</p>
<blockquote>
<ul>
<li>即使遵循该规则，弧线仍然需要更多额外的工作。如果使用Core Graphics函数通过在ULO坐标系中定位点来创建路径，随后在UIKit的view中渲染路径，弧线的方向是不同的。查看更多相关信息<a href="https://developer.apple.com/library/ios/documentation/2DDrawing/Conceptual/DrawingPrintingiOS/GraphicsDrawingOverview/GraphicsDrawingOverview.html#//apple_ref/doc/uid/TP40010156-CH14-SW8" target="_blank" rel="external">Side Effects of Drawing with Different Coordinate Systems</a></li>
</ul>
</blockquote>
<p>在iOS中创建路径，更推荐使用<code>UIBezierPath</code>来代替<code>CGPath</code>方法，除非需要使用CoreGraphics的特性，例如在路径中添加椭圆。更多创建和渲染路径的方法，点击<a href="https://developer.apple.com/library/ios/documentation/2DDrawing/Conceptual/DrawingPrintingiOS/BezierPaths/BezierPaths.html#//apple_ref/doc/uid/TP40010156-CH11-SW1" target="_blank" rel="external"><code>Drawing Shapes Using Bézier Paths</code></a></p>
<p>更多关于使用UIBezierPath绘制路径的方法，查看<a href="https://developer.apple.com/library/ios/documentation/2DDrawing/Conceptual/DrawingPrintingiOS/BezierPaths/BezierPaths.html#//apple_ref/doc/uid/TP40010156-CH11-SW1" target="_blank" rel="external"><code>Drawing Shapes Using Bézier Paths</code></a>。更多关于使用CoreGraphics绘制路径，例如如何指定点到复杂路径中，查看Quartz 2D中的<a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/dq_paths/dq_paths.html#//apple_ref/doc/uid/TP30001066-CH211" target="_blank" rel="external"><code>Paths</code></a>。更多关于创建路径的信息<a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CGContext/index.html#//apple_ref/doc/uid/TP30000950" target="_blank" rel="external"><code>CGContext Reference</code></a>和<a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CGPath/index.html#//apple_ref/doc/uid/TP30000959" target="_blank" rel="external"><code>CGPath Reference</code></a></p>
<h4 id="创建图案，渐变和阴影"><a href="#创建图案，渐变和阴影" class="headerlink" title="创建图案，渐变和阴影"></a>创建图案，渐变和阴影</h4><p>CoreGraphics框架包含了创建图案，渐变，阴影的功能。你可以使用这些来创建非黑白色并且使用使用它们填充你创建的路径。图案是从重复的图片或内容中创建出来的。渐变和阴影可提供不同的方案来创建颜色到颜色的平滑的过度。</p>
<p>创建，使用图案，渐变和阴影的更多细节，查看<a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/Introduction/Introduction.html#//apple_ref/doc/uid/TP30001066" target="_blank" rel="external"><code>Quartz 2D Programming Guide</code></a></p>
<h4 id="自定义坐标空间"><a href="#自定义坐标空间" class="headerlink" title="自定义坐标空间"></a>自定义坐标空间</h4><p>UIKit默认直接创建用于映射point到px的当前转换矩阵。尽管在绘制中完全不需要修改这个矩阵，但有时候更改该矩阵会更方便。</p>
<p>当view第一次调用<code>drawRect:</code>时，CTM(当前转换矩阵)已经配置好所以坐标系原点与view的原点相匹配，X轴向右为正，Y轴向下为正。然而你可以通过添加缩放，旋转和转换因子来改变CTM从而改变大小，方向，并且默认坐标系的位置与底层的view或window有关。</p>
<h5 id="使用坐标变换来提升绘制表现"><a href="#使用坐标变换来提升绘制表现" class="headerlink" title="使用坐标变换来提升绘制表现"></a>使用坐标变换来提升绘制表现</h5><p>修改CTM是绘制内容的一个基础技巧，因为它允许你重用路径，这样可能会减少绘制时的计算量。举个栗子，如果你想在(20,20)画一个正方形，需要创建一个路径移动到(20,20)随后绘制必要的线条。然而，如果你又想把正方形移动到(10,10)，可能需要重新创建新起点的路径。因为创建路径实在是一个消耗较大的操作，它会更倾向于创建一个原点在(0,0)的正方形，然后修改CTM使得正方形绘制在正确区域。</p>
<p>在CoreGraphics框架中有两种方式可以修改CTM。可以使用<a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CGContext/index.html#//apple_ref/doc/uid/TP30000950" target="_blank" rel="external"><code>CGContext Reference</code></a>中定义的CTM操作函数立刻修改CTM。也可以创建一个<a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CGAffineTransform/index.html#//apple_ref/c/tdef/CGAffineTransform" target="_blank" rel="external"><code>CGAffineTransform</code></a>结构体，应用各种你想使用的变换，然后将这个变换应用到CTM中。使用仿射变换可以让你的组(group)变换随后立刻应用到CTM上。你也可以评估，倒置仿射变换并用它们来修正代码中的点，大小和矩形值。更多仿射变换信息<a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/Introduction/Introduction.html#//apple_ref/doc/uid/TP30001066" target="_blank" rel="external"><code>Quartz 2D Programming Guide</code></a> 和 <a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CGAffineTransform/index.html#//apple_ref/doc/uid/TP30000946" target="_blank" rel="external"><code>CGAffineTransform Reference</code></a></p>
<h5 id="翻转默认坐标系"><a href="#翻转默认坐标系" class="headerlink" title="翻转默认坐标系"></a>翻转默认坐标系</h5><p>Flipping in UIKit drawing modifies the backing CALayer to align a drawing environment having a LLO coordinate system with the default coordinate system of UIKit。如果仅使用UIKit来绘制，就不需要翻转CTM。然而如果是CoreGraphics和UIKit调用的图片I/O 函数混合使用，这时候翻转就派上用场了。</p>
<p>如果你调用CoreGraphics绘制了图片或PDF文档，对象会在view的上下文中渲染的乱七八糟。你必须翻转CTM让图片和文稿正确显示。</p>
<p>翻转绘制在CoreGraphics上下文中的对象以便于在UIKit的view中正确显示，修改CTM一共分两步。将原点变换到绘制区域的左上角，随后进行尺寸变换，修改y-coordinate为-1，代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CGContextSaveGState(graphicsContext);</span><br><span class="line">CGContextTranslateCTM(graphicsContext, 0.0, imageHeight);</span><br><span class="line">CGContextScaleCTM(graphicsContext, 1.0, -1.0);</span><br><span class="line">CGContextDrawImage(graphicsContext, image, CGRectMake(0, 0, imageWidth, imageHeight));</span><br><span class="line">CGContextRestoreGState(graphicsContext);</span><br></pre></td></tr></table></figure></p>
<p>如果通过CoreGraphics image对象初始化了一个UIImage对象，UIKit自动帮你翻转。每一个UIImage对象是由<code>CGImageRef</code>类型构成的。可以通过CGImage属性获取CoreGraphics对象并且做一些操作。当完成后，从修改后的<code>CGImageRef</code>对象中可以重建UIImage对象</p>
<blockquote>
<p>可用CoreGraphics方法<code>CGContextDrawImage</code>来绘制渲染目标。它有两个参数，第一个是图形上下文，第二个是矩形区域(既是图片的大小同时也是绘制表面的位置，比如View)。当使用该方法时，如果不调整当前坐标系为LLO，图片在UIKit的view中会颠倒。另外，矩形的原点是相对于函数调用时刻当前坐标原点。</p>
</blockquote>
<h5 id="不同坐标系绘制的副作用"><a href="#不同坐标系绘制的副作用" class="headerlink" title="不同坐标系绘制的副作用"></a>不同坐标系绘制的副作用</h5><p>假设使用LLO坐标系调用<code>CGContextAddArc</code>和<code>CGPathAddArc</code>绘制路径，需要翻转CTM来在UIKit的view中正确渲染弧线。如果使用如果在ULO坐标系中渲染到UIKit的view上，你会发现弧线会和初始的不一样。当使用<code>UIBezierPath</code>绘制弧线时，弧线的终点与LLO相反，例如，一个向下的箭头现在向上，并且顺逆相反。你必须将CoreGraphics中绘制的弧线改成基于ULO坐标系；这些函数的<code>startAngle</code>和<code>endAngle</code>控制了弧线方向。</p>
<p><img src="https://developer.apple.com/library/ios/documentation/2DDrawing/Conceptual/DrawingPrintingiOS/Art/flipped_coordinates-1_2x.png" alt=""></p>
<p>(通过调用<code>CGContextRotateCTM</code>)可以旋转对象，你会观察出它们完全是镜像效果。如果旋转一个ULO坐标系的CoreGraphics中的对象，它的方向是和UIKit中的旋转方向相反。你必须为在代码中为他们设置不同的旋转方向(<code>CGContextRotateCTM</code>)，反转<code>angle</code>的参数</p>
<h5 id="阴影"><a href="#阴影" class="headerlink" title="阴影"></a>阴影</h5><p>盈盈的方向是对象指定偏移量，也就是说偏移量在绘制框架中是一个惯例。在UIKit中，xy轴的正向偏移量似的阴影向下、向右。在CoreGraphics中，则是向上、向右。翻转CTM使得默认坐标系对齐不会影响对象的阴影，阴影也不会正确的追踪对象。如果想正确的追踪，必须修改当前坐标系的偏移量。</p>
<blockquote>
<p>在iOS3.2以上，CoreGraphics和UIKit拥有共同的阴影方向：正向偏移量使得阴影向下、向右。</p>
</blockquote>
<hr>
<h3 id="应用CoreAnimation效果"><a href="#应用CoreAnimation效果" class="headerlink" title="应用CoreAnimation效果"></a>应用CoreAnimation效果</h3><p>CoreAnimation是OC中提供快速便捷创造流动，实时的动画。CoreAnimation本身不是一个绘制技术，也就是说它不提供创建图形，图片或其他内容。相反的，它是一个操纵并展示由其他技术创建的内容。</p>
<p>在很多案例中，付出一点就可以从CoreAnimation中获得好处。例如，UIView的很多属性(包括view的frame,center,color，opacity)可以配置在值变化时触发动画。你需要做一些事情来让UIkit知道你想执行这些动画，但它们却是自动为你运行的。更多关于如何触发view内置动画，查看<a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIView_Class/index.html#//apple_ref/doc/uid/TP40006816-CH3-SW62" target="_blank" rel="external"><code>Animating Views</code></a>和<a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIView_Class/index.html#//apple_ref/doc/uid/TP40006816" target="_blank" rel="external"><code>UIView Class Reference</code></a></p>
<p>如果想查看更多高级动画教程，查看<a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/CoreAnimation_guide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40004514" target="_blank" rel="external"><code>Core Animation Programming Guide</code></a></p>
<h4 id="关于Layer"><a href="#关于Layer" class="headerlink" title="关于Layer"></a>关于Layer</h4><p>CoreAnimation的核心技术就是layer对象。layer是和view相似的轻量级对象，但它们实际上是一个模型对象。封装了几何、时间、视觉属性等你想展示的内容。</p>
<blockquote>
<ul>
<li>将CGImageRef赋值到layer对象的contents属性</li>
<li>给layer赋值一个delegate并处理绘制</li>
<li>可以子类化CALayer并重载其中的显示方法。</li>
</ul>
</blockquote>
<p>Layer相关信息请看<a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/CoreAnimation_guide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40004514" target="_blank" rel="external"><code>Core Animation Programming Guide</code></a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/30/hello-world/" itemprop="url">
                  Hello World
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-30T10:17:34+08:00" content="2016-05-30">
              2016-05-30
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/30/hello-world/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/30/hello-world/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/05/30/hello-world/" class="leancloud_visitors" data-flag-title="Hello World">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="CJ" />
          <p class="site-author-name" itemprop="name">CJ</p>
          <p class="site-description motion-element" itemprop="description">嘿嘿嘿</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">2</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CJ</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

本站总访问量 <span id="busuanzi_value_site_pv"></span> &nbsp&nbsp&nbsp
您是第<span id="busuanzi_value_site_uv"></span>个来到的小伙伴

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"jzy476731162"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  






  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });
                            
                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').mousedown(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("fgE5GnxPGNeNoHutRS3FxbqO-gzGzoHsz", "lSfNui3vq5Yp6x4rjWSlvN2k");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>
